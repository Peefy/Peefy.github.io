"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[32556],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>k});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),u=p(n),m=o,k=u["".concat(s,".").concat(m)]||u[m]||d[m]||i;return n?a.createElement(k,l(l({ref:t},c),{},{components:n})):a.createElement(k,l({ref:t},c))}));function k(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,l=new Array(i);l[0]=m;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r[u]="string"==typeof e?e:o,l[1]=r;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},70018:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>r,toc:()=>p});var a=n(87462),o=(n(67294),n(3905));const i={slug:"2023-09-15-kcl-0.6.0-release",title:"KCL v0.6.0 Release Blog",authors:{name:"KCL Team",title:"KCL Team"},tags:["Release Blog","KCL"]},l=void 0,r={permalink:"/blog/2023-09-15-kcl-0.6.0-release",editUrl:"https://github.com/kcl-lang/kcl-lang.io/tree/main/blog/2023-09-15-kcl-0.6.0-release/index.md",source:"@site/blog/2023-09-15-kcl-0.6.0-release/index.md",title:"KCL v0.6.0 Release Blog",description:"Introduction",date:"2023-09-15T00:00:00.000Z",formattedDate:"September 15, 2023",tags:[{label:"Release Blog",permalink:"/blog/tags/release-blog"},{label:"KCL",permalink:"/blog/tags/kcl"}],readingTime:15.015,hasTruncateMarker:!1,authors:[{name:"KCL Team",title:"KCL Team"}],frontMatter:{slug:"2023-09-15-kcl-0.6.0-release",title:"KCL v0.6.0 Release Blog",authors:{name:"KCL Team",title:"KCL Team"},tags:["Release Blog","KCL"]},prevItem:{title:"KCL Joining CNCF as a Sandbox Project! \ud83c\udf89",permalink:"/blog/2023-09-19-kcl-joining-cncf-sandbox"},nextItem:{title:"A New Paradigm for Dynamic Configuration Management - KRM KCL Specification",permalink:"/blog/2023-09-06-dcm-using-kcl"}},s={authorsImageUrls:[void 0]},p=[{value:"Introduction",id:"introduction",level:2},{value:"Language",id:"language",level:2},{value:"\ud83d\udd27 Type system enhancement",id:"-type-system-enhancement",level:3},{value:"\ud83c\udfc4 API Update",id:"-api-update",level:3},{value:"\ud83d\udc1e Bug Fixes",id:"-bug-fixes",level:3},{value:"Fix schema required/optional attribute check in KCL",id:"fix-schema-requiredoptional-attribute-check-in-kcl",level:4},{value:"IDE &amp; Toolchain Updates",id:"ide--toolchain-updates",level:2},{value:"IDE Updates",id:"ide-updates",level:3},{value:"Features",id:"features",level:4},{value:"IDE Extension Updates",id:"ide-extension-updates",level:4},{value:"KCL Formatting Tool Updates",id:"kcl-formatting-tool-updates",level:3},{value:"KCL Documentation Tool Updates",id:"kcl-documentation-tool-updates",level:3},{value:"Generate model document from kpm package",id:"generate-model-document-from-kpm-package",level:4},{value:"Automatic synchronization of documents through CI pipelines",id:"automatic-synchronization-of-documents-through-ci-pipelines",level:4},{value:"KCL Import Tool Updates",id:"kcl-import-tool-updates",level:3},{value:"Package Manage Tool Updates",id:"package-manage-tool-updates",level:3},{value:"kpm pull supports pulling packages by package name",id:"kpm-pull-supports-pulling-packages-by-package-name",level:4},{value:"kpm supports adding local paths as dependencies",id:"kpm-supports-adding-local-paths-as-dependencies",level:4},{value:"kpm adds checking for existing package tags",id:"kpm-adds-checking-for-existing-package-tags",level:4},{value:"Integrations",id:"integrations",level:2},{value:"Helmfile KCL Plugin",id:"helmfile-kcl-plugin",level:3},{value:"KCL Operator",id:"kcl-operator",level:3},{value:"0. Prerequisites",id:"0-prerequisites",level:4},{value:"1. Install KCL Operator",id:"1-install-kcl-operator",level:4},{value:"2. Deploy KCL Annotation Setting Model",id:"2-deploy-kcl-annotation-setting-model",level:4},{value:"3. Deploy a Pod to Verify the Model Result",id:"3-deploy-a-pod-to-verify-the-model-result",level:4},{value:"Vault Integration",id:"vault-integration",level:3},{value:"GitLab CI Integration",id:"gitlab-ci-integration",level:3},{value:"Other Updates and Bug Fixes",id:"other-updates-and-bug-fixes",level:2},{value:"Documents",id:"documents",level:2},{value:"Community",id:"community",level:2},{value:"Additional Resources",id:"additional-resources",level:2},{value:"Resources",id:"resources",level:2}],c={toc:p},u="wrapper";function d(e){let{components:t,...i}=e;return(0,o.kt)(u,(0,a.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"The KCL team is pleased to announce that KCL v0.6.0 is now available! This release has brought three key updates to everyone: ",(0,o.kt)("strong",{parentName:"p"},"Language"),", ",(0,o.kt)("strong",{parentName:"p"},"Tools"),", and ",(0,o.kt)("strong",{parentName:"p"},"Integrations"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"Use KCL language, tools and IDE extensions with more complete features and fewer errors to improve code writing experience and efficiency.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"Use KPM, OCI Registry and other tools to directly use and share your cloud native domain models, reducing learning and hands-on costs.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"Use cloud-native integration extensions such as Helmfile KCL plugin and KCL Operator to simultaneously support in-place mutation and validation of Kubernetes resources on both the client and runtime, avoiding hardcoded configurations."))),(0,o.kt)("p",null,"You can visit the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang/kcl/releases/tag/v0.6.0"},"KCL release page")," or the ",(0,o.kt)("a",{parentName:"p",href:"https://kcl-lang.io/"},"KCL website")," to get KCL binary download link and more detailed release information."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang/kcl"},"KCL")," is an open-source, constraint-based record and functional language. KCL improves the writing of numerous complex configurations, such as cloud-native scenarios, through its mature programming language technology and practice. It is dedicated to building better modularity, scalability, and stability around configurations, simpler logic writing, faster automation, and great built-in or API-driven integrations."),(0,o.kt)("p",null,"This blog will introduce the content of KCL v0.6.0 and recent developments in the KCL community to readers."),(0,o.kt)("h2",{id:"language"},"Language"),(0,o.kt)("h3",{id:"-type-system-enhancement"},"\ud83d\udd27 Type system enhancement"),(0,o.kt)("p",null,"Support automatic type inference for KCL configuration block attributes. Prior to version 0.6.0 of KCL, the key1 and key2 attributes in the code snippet below would be inferred as type str | int. With the updated version, we have further improved the precision of type inference for configuration attributes, so key1 and key2 will have more specific and precise corresponding types."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'config = {\n    key1 = "value1"\n    key2 = 2\n}\nkey1 = config.key1  # The type of key1 is str\nkey2 = config.key2  # The type of key2 is int\n')),(0,o.kt)("p",null,"In addition, we have optimized error messages for schema semantic checking, union type checking, and type checking errors in system library functions."),(0,o.kt)("p",null,"For more information, please refer to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang/kcl/pull/678"},"here")),(0,o.kt)("h3",{id:"-api-update"},"\ud83c\udfc4 API Update"),(0,o.kt)("p",null,"KCL Schema model parsing: The GetSchemaType API is used to retrieve KCL package-related information and default values for schema attributes."),(0,o.kt)("h3",{id:"-bug-fixes"},"\ud83d\udc1e Bug Fixes"),(0,o.kt)("h4",{id:"fix-schema-requiredoptional-attribute-check-in-kcl"},"Fix schema required/optional attribute check in KCL"),(0,o.kt)("p",null,"In previous versions of KCL, the required/optional attribute check for KCL would miss nested schema attribute checks. In version KCL v0.6.0, we have fixed such similar issues."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"schema S:\n    a: int\n    b: str\nschema L:\n    # In previous versions, the required attribute check for attributes 'a' and 'b' of S in [S] and {str:S} would be missed.\n    # This issue has been fixed in KCL v0.6.0 and later versions.\n    ss?: [S]\n    sss?: {str:S}\nl = L {\n    ss = [S {b = \"b\"}]\n}\n")),(0,o.kt)("p",null,"For more information, please see ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang/kcl/pull/672"},"here")),(0,o.kt)("h2",{id:"ide--toolchain-updates"},"IDE & Toolchain Updates"),(0,o.kt)("h3",{id:"ide-updates"},"IDE Updates"),(0,o.kt)("h4",{id:"features"},"Features"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Performance improvement for all IDE features"),(0,o.kt)("li",{parentName:"ul"},"Support variable and schema attribute completion for KCL packages"),(0,o.kt)("li",{parentName:"ul"},"Support KCL schema attribute document attribute hover"),(0,o.kt)("li",{parentName:"ul"},"Support for quick fix of useless import statements")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"ide-quick-fix",src:n(98273).Z,width:"956",height:"590"})),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Support right-click formatting of files and code fragments in VS Code.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"ide-format",src:n(93713).Z,width:"780",height:"400"})),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Support hover for built-in functions and function information in system libraries")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"ide-func-hover",src:n(4102).Z,width:"1726",height:"306"})),(0,o.kt)("h4",{id:"ide-extension-updates"},"IDE Extension Updates"),(0,o.kt)("p",null,"We have integrated the KCL language server LSP into NeoVim and Idea, enabling the completion, navigation, and hover features supported by VS Code IDE in NeoVim and IntelliJ IDEA."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"NeoVim KCL Extension")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"kcl.nvim",src:n(28522).Z,width:"1246",height:"1121"})),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"IntelliJ Extension")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"intellij",src:n(47669).Z,width:"1041",height:"650"})),(0,o.kt)("p",null,"For more information on downloading, installation, and features of the IDE plugins, please refer to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://kcl-lang.io/docs/user_docs/getting-started/install#neovim"},"https://kcl-lang.io/docs/user_docs/getting-started/install#neovim")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://kcl-lang.io/docs/user_docs/getting-started/install#intellij-idea"},"https://kcl-lang.io/docs/user_docs/getting-started/install#intellij-idea"))),(0,o.kt)("h3",{id:"kcl-formatting-tool-updates"},"KCL Formatting Tool Updates"),(0,o.kt)("p",null,"Support formatting of configuration blocks with incorrect indentation"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Before formatting")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"config = {\na ={\nx = 1\n y =2\n}\nb = {\n x = 1\n y = 2\n}\n}\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"After formatting")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"config = {\n    a = {\n        x = 1\n        y = 2\n    }\n    b = {\n        x = 1\n        y = 2\n    }\n}\n")),(0,o.kt)("h3",{id:"kcl-documentation-tool-updates"},"KCL Documentation Tool Updates"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Support for exporting Markdown documents"),(0,o.kt)("li",{parentName:"ul"},"Support for exporting document index pages"),(0,o.kt)("li",{parentName:"ul"},"Support for exporting documents with custom style templates"),(0,o.kt)("li",{parentName:"ul"},"Support for HTML escaping in exported documents"),(0,o.kt)("li",{parentName:"ul"},"Enhanced document generation to parse and render example code snippets in document comments"),(0,o.kt)("li",{parentName:"ul"},"By tracking model updates in Github workflow and regenerating the documentation, automatic synchronization of the documentation can be achieved. Please refer to ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/KusionStack/catalog/pull/31/files"},"here")," for more details.")),(0,o.kt)("h4",{id:"generate-model-document-from-kpm-package"},"Generate model document from kpm package"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Create a kpm package and add documentation comments (using docstring) to the ",(0,o.kt)("inlineCode",{parentName:"li"},"Service")," model. The documentation can include explanations, example code, and usage instructions to help other developers quickly get started and use it correctly.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'\n\u279c kpm init demo\n\n\u279c cat > demo/server.k << EOF\nschema Service:\n    """\n    Service is a kind of workload profile that describes how to run your application code. This\n    is typically used for long-running web applications that should "never" go down, and handle\n    short-lived latency-sensitive web requests, or events.\n    \n    Attributes\n    ----------\n    workloadType : str = "Deployment" | "StatefulSet", default is Deployment, required.\n        workloadType represents the type of workload used by this Service. Currently, it supports several\n        types, including Deployment and StatefulSet.\n    image : str, default is Undefined, required.\n        Image refers to the Docker image name to run for this container.\n        More info: https://kubernetes.io/docs/concepts/containers/images\n    replicas : int, default is 2, required.\n        Number of container replicas based on this configuration that should be ran.\n    \n    Examples\n    --------\n    # Instantiate a long-running service and its image is "nginx:v1"\n\n    svc = Service {\n        workloadType: "Deployment"\n        image: "nginx:v1"\n        replica: 2\n    }\n    """\n    workloadType: "Deployment" | "StatefulSet"\n    image: str\n    replica: int\nEOF\n\n')),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Generate the package documentation in Markdown format")),(0,o.kt)("p",null,"The following command will output the demo package documentation to the ",(0,o.kt)("inlineCode",{parentName:"p"},"doc/")," directory in the current working directory:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kcl-go doc generate --file-path demo\n")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"docgen",src:n(55779).Z,width:"1846",height:"1510"})),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"For more usage details, please use ",(0,o.kt)("inlineCode",{parentName:"p"},"kcl-go doc generate -h")," to refer to the help information.")),(0,o.kt)("h4",{id:"automatic-synchronization-of-documents-through-ci-pipelines"},"Automatic synchronization of documents through CI pipelines"),(0,o.kt)("p",null,"Implement automatic documentation synchronization through a pipeline By tracking model updates in a Github workflow and regenerating the documentation, automatic synchronization of the documentation can be achieved. You can refer to the approach in the ",(0,o.kt)("inlineCode",{parentName:"p"},"Kusionstack/catalog")," repo to generate the documentation and automatically submit change PRs to the documentation repository."),(0,o.kt)("p",null,"By tracking model updates in Github workflow and regenerating documents, automatic document synchronization can be achieved. Can refer to the approach in the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/KusionStack/catalog/pull/31/files"},"Kusionstack/catalog")," repo is to generate documents and automatically submit change PRs to the document repository."),(0,o.kt)("h3",{id:"kcl-import-tool-updates"},"KCL Import Tool Updates"),(0,o.kt)("p",null,"The KCL Import Tool now adds support for converting Terraform Provider Schema to KCL Schema based on Protobuf, JsonSchema OpenAPI models, and Go Structures, such as the following Terraform Provider Json (obtained through the command ",(0,o.kt)("inlineCode",{parentName:"p"},"terraform providers schema -json > provider.json")," , For more details, please refer to ",(0,o.kt)("a",{parentName:"p",href:"https://developer.hashicorp.com/terraform/cli/commands/providers/schema"},"https://developer.hashicorp.com/terraform/cli/commands/providers/schema"),")"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "format_version": "0.2",\n    "provider_schemas": {\n        "registry.terraform.io/aliyun/alicloud": {\n            "provider": {\n                "version": 0,\n                "block": {\n                    "attributes": {},\n                    "block_types": {},\n                    "description_kind": "plain"\n                }\n            },\n            "resource_schemas": {\n                "alicloud_db_instance": {\n                    "version": 0,\n                    "block": {\n                        "attributes": {\n                            "db_instance_type": {\n                                "type": "string",\n                                "description_kind": "plain",\n                                "computed": true\n                            },\n                            "engine": {\n                                "type": "string",\n                                "description_kind": "plain",\n                                "required": true\n                            },\n                            "security_group_ids": {\n                                "type": [\n                                    "set",\n                                    "string"\n                                ],\n                                "description_kind": "plain",\n                                "optional": true,\n                                "computed": true\n                            },\n                            "security_ips": {\n                                "type": [\n                                    "set",\n                                    "string"\n                                ],\n                                "description_kind": "plain",\n                                "optional": true,\n                                "computed": true\n                            },\n                            "tags": {\n                                "type": [\n                                    "map",\n                                    "string"\n                                ],\n                                "description_kind": "plain",\n                                "optional": true\n                            }\n                        },\n                        "block_types": {},\n                        "description_kind": "plain"\n                    }\n                },\n                "alicloud_config_rule": {\n                    "version": 0,\n                    "block": {\n                        "attributes": {\n                            "compliance": {\n                                "type": [\n                                    "list",\n                                    [\n                                        "object",\n                                        {\n                                            "compliance_type": "string",\n                                            "count": "number"\n                                        }\n                                    ]\n                                ],\n                                "description_kind": "plain",\n                                "computed": true\n                            },\n                            "resource_types_scope": {\n                                "type": [\n                                    "list",\n                                    "string"\n                                ],\n                                "description_kind": "plain",\n                                "optional": true,\n                                "computed": true\n                            }\n                        }\n                    }\n                }\n            },\n            "data_source_schemas": {}\n        }\n    }\n}\n')),(0,o.kt)("p",null,"Then the tool can output the following KCL code"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'"""\nThis file was generated by the KCL auto-gen tool. DO NOT EDIT.\nEditing this file might prove futile when you re-run the KCL auto-gen generate command.\n"""\n\nschema AlicloudConfigRule:\n    """\n    AlicloudConfigRule\n\n    Attributes\n    ----------\n    compliance: [ComplianceObject], optional\n    resource_types_scope: [str], optional\n    """\n\n    compliance?: [ComplianceObject]\n    resource_types_scope?: [str]\n\nschema ComplianceObject:\n    """\n    ComplianceObject\n\n    Attributes\n    ----------\n    compliance_type: str, optional\n    count: int, optional\n    """\n\n    compliance_type?: str\n    count?: int\n\nschema AlicloudDbInstance:\n    """\n    AlicloudDbInstance\n\n    Attributes\n    ----------\n    db_instance_type: str, optional\n    engine: str, required\n    security_group_ids: [str], optional\n    security_ips: [str], optional\n    tags: {str:str}, optional\n    """\n\n    db_instance_type?: str\n    engine: str\n    security_group_ids?: [str]\n    security_ips?: [str]\n    tags?: {str:str}\n\n    check:\n        isunique(security_group_ids)\n        isunique(security_ips)\n')),(0,o.kt)("h3",{id:"package-manage-tool-updates"},"Package Manage Tool Updates"),(0,o.kt)("h4",{id:"kpm-pull-supports-pulling-packages-by-package-name"},"kpm pull supports pulling packages by package name"),(0,o.kt)("p",null,"kpm supports pulling the corresponding package by using the ",(0,o.kt)("inlineCode",{parentName:"p"},"kpm pull <package_name>:<package_version>")," command."),(0,o.kt)("p",null,"Taking the ",(0,o.kt)("inlineCode",{parentName:"p"},"k8s")," package as an example, you can directly download the package to your local machine using the following commands:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kpm pull k8s\n")),(0,o.kt)("p",null,"or"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kpm pull k8s:1.27\n")),(0,o.kt)("p",null,"The package downloaded with kpm pull will be saved in the directory ",(0,o.kt)("inlineCode",{parentName:"p"},"<execution_directory>/<oci_registry>/<package_name>"),". For example, if you use the default kpm registry and run the kpm pull k8s command, you can find the downloaded content in the directory ",(0,o.kt)("inlineCode",{parentName:"p"},"<execution_directory>/ghcr.io/kcl-lang/k8s"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ tree ghcr.io/kcl-lang/k8s -L 1\n\nghcr.io/kcl-lang/k8s\n\u251c\u2500\u2500 api\n\u251c\u2500\u2500 apiextensions_apiserver\n\u251c\u2500\u2500 apimachinery\n\u251c\u2500\u2500 kcl.mod\n\u251c\u2500\u2500 kcl.mod.lock\n\u251c\u2500\u2500 kube_aggregator\n\u2514\u2500\u2500 vendor\n\n6 directories, 2 files\n")),(0,o.kt)("h4",{id:"kpm-supports-adding-local-paths-as-dependencies"},"kpm supports adding local paths as dependencies"),(0,o.kt)("p",null,'"Different projects have different KCL packages, and there are dependencies between them. However, they are stored in different directories. I hope that these packages stored in different directories can be managed together, rather than having to put them together for them to compile." If you also have this need, you can try this feature. The kpm add command currently supports adding local paths as dependencies to a KCL package. You just need to run the command ',(0,o.kt)("inlineCode",{parentName:"p"},"kpm add <local_package_path>"),", and your local package will be added as a third-party library dependency to the current package."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kpm pull k8s\n")),(0,o.kt)("p",null,"After completion, you can find the downloaded k8s package in the directory ",(0,o.kt)("inlineCode",{parentName:"p"},'"the_directory_where_you_executed_the_command/ghcr.io/kcl-lang/k8s"'),".\nCreate a new KCL package using the ",(0,o.kt)("inlineCode",{parentName:"p"},"kpm init mynginx")," command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kpm init mynginx\n")),(0,o.kt)("p",null,"Then, navigate into this package."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"cd mynginx\n")),(0,o.kt)("p",null,"Inside this package, you can use the kpm add command to add the k8s package you downloaded locally as a third-party library dependency to ",(0,o.kt)("inlineCode",{parentName:"p"},"mynginx"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kpm add ../ghcr.io/kcl-lang/k8s/\n")),(0,o.kt)("p",null,"Next, add the following content to ",(0,o.kt)("inlineCode",{parentName:"p"},"main.k"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'import k8s.api.core.v1 as k8core\n\nk8core.Pod {\n    metadata.name = "web-app"\n    spec.containers = [{\n        name = "main-container"\n        image = "nginx"\n        ports = [{containerPort: 80}]\n    }]\n}\n')),(0,o.kt)("p",null,"Normal compilation can be performed through the ",(0,o.kt)("inlineCode",{parentName:"p"},"kpm run")," command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kpm run\n")),(0,o.kt)("h4",{id:"kpm-adds-checking-for-existing-package-tags"},"kpm adds checking for existing package tags"),(0,o.kt)("p",null,"We have added a check for duplicate tags in the ",(0,o.kt)("inlineCode",{parentName:"p"},"kpm push")," command. In order to avoid situations where packages with the same tag have different content, we have added restrictions on the push function in the ",(0,o.kt)("inlineCode",{parentName:"p"},"kpm"),". If the version of the kcl package you push already exists, you will not be able to push the current kcl package. You will receive the following information:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kpm: package 'my_package' will be pushed.\nkpm: package version '0.1.0' already exists\n")),(0,o.kt)("p",null,"Modifying the content of a package that has already been pushed to the registry without changing the tag carries a high risk, as the package may already be in use by others. Therefore, if you need to push your package, we recommend:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Change your tag and follow semantic versioning conventions."),(0,o.kt)("li",{parentName:"ul"},"If you must modify the content of a package without changing the tag, you will need to delete the existing tag from the registry.")),(0,o.kt)("h2",{id:"integrations"},"Integrations"),(0,o.kt)("h3",{id:"helmfile-kcl-plugin"},"Helmfile KCL Plugin"),(0,o.kt)("p",null,"Helmfile is a declarative specification and tool for deploying Helm Charts. With the Helmfile KCL plugin, you can:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Edit or verify Helm Chart through non-invasive hook methods, separating the data and logic parts of Kubernetes configuration management",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Modify resource labels/annotations, inject sidecar container configuration"),(0,o.kt)("li",{parentName:"ul"},"Use KCL schema to validate resources"),(0,o.kt)("li",{parentName:"ul"},"Define your own abstract application models"))),(0,o.kt)("li",{parentName:"ul"},"Maintain multiple environment and tenant configurations elegantly, rather than simply copying and pasting.")),(0,o.kt)("p",null,"Here is a detailed explanation using a simple example. With the Helmfile KCL plugin, you do not need to install any components related to KCL. You only need the latest version of the Helmfile tool on your local device."),(0,o.kt)("p",null,"We can write a ",(0,o.kt)("inlineCode",{parentName:"p"},"helmfile.yaml")," file as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'repositories:\n-\xa0name:\xa0prometheus-community\n\xa0\xa0url:\xa0https://prometheus-community.github.io/helm-charts\n\nreleases:\n-\xa0name:\xa0prom-norbac-ubuntu\n\xa0\xa0namespace:\xa0prometheus\n\xa0\xa0chart:\xa0prometheus-community/prometheus\n\xa0\xa0set:\n\xa0\xa0-\xa0name:\xa0rbac.create\n\xa0\xa0\xa0\xa0value:\xa0false\n\xa0\xa0transformers:\n\xa0\xa0#\xa0Use\xa0KCL\xa0Plugin\xa0to\xa0mutate\xa0or\xa0validate\xa0Kubernetes\xa0manifests.\n\xa0\xa0-\xa0apiVersion:\xa0krm.kcl.dev/v1alpha1\n\xa0\xa0\xa0\xa0kind:\xa0KCLRun\n\xa0\xa0\xa0\xa0metadata:\n\xa0\xa0\xa0\xa0\xa0\xa0name:\xa0"set-annotation"\n\xa0\xa0\xa0\xa0\xa0\xa0annotations:\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0config.kubernetes.io/function:\xa0|\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0container:\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0image:\xa0docker.io/kcllang/kustomize-kcl:v0.2.0\n\xa0\xa0\xa0\xa0spec:\n\xa0\xa0\xa0\xa0\xa0\xa0source:\xa0|\n\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0[resource\xa0|\xa0{if\xa0resource.kind\xa0==\xa0"Deployment":\xa0metadata.annotations:\xa0{"managed-by"\xa0=\xa0"helmfile-kcl"}}\xa0for\xa0resource\xa0in\xa0option("resource_list").items]\n')),(0,o.kt)("p",null,"In the above file, we referenced the Prometheus Helm Chart and injected the ",(0,o.kt)("inlineCode",{parentName:"p"},'managed-by="helmfile-kcl"')," label into all deployment resources of Prometheus with just one line of KCL code. The following command can be used to deploy the above configuration to the Kubernetes cluster:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"helmfile\xa0apply\n")),(0,o.kt)("p",null,"For more use cases, please refer to ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang/krm-kcl"},"https://github.com/kcl-lang/krm-kcl")),(0,o.kt)("h3",{id:"kcl-operator"},"KCL Operator"),(0,o.kt)("p",null,"KCL Operator provides cluster integration, allowing you to use Access Webhook to generate, mutate, or validate resources based on KCL configuration when apply resources to the cluster. Webhook will capture creation, application, and editing operations, and execute ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang/krm-kcl"},"KCLRun")," on the configuration associated with each operation, and the KCL programming language can be used to"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Add labels or annotations based on a condition."),(0,o.kt)("li",{parentName:"ul"},"Inject a sidecar container in all KRM resources that contain a ",(0,o.kt)("inlineCode",{parentName:"li"},"PodTemplate"),"."),(0,o.kt)("li",{parentName:"ul"},"Validating all KRM resources using KCL Schema, such as constraints on starting containers only in a root mode."),(0,o.kt)("li",{parentName:"ul"},"Generating KRM resources using an abstract model or combining and using different KRM APIs. ")),(0,o.kt)("p",null,"Here is a simple resource annotation mutation example to introduce the usage of the KCL operator."),(0,o.kt)("h4",{id:"0-prerequisites"},"0. Prerequisites"),(0,o.kt)("p",null,"Prepare a Kubernetes cluster like ",(0,o.kt)("inlineCode",{parentName:"p"},"k3d")," the kubectl tool."),(0,o.kt)("h4",{id:"1-install-kcl-operator"},"1. Install KCL Operator"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f https://raw.githubusercontent.com/kcl-lang/kcl-operator/main/config/all.yaml\n")),(0,o.kt)("p",null,"Use the following command to observe and wait for the pod status to be ",(0,o.kt)("inlineCode",{parentName:"p"},"Running"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get po\n")),(0,o.kt)("h4",{id:"2-deploy-kcl-annotation-setting-model"},"2. Deploy KCL Annotation Setting Model"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f- << EOF\napiVersion: krm.kcl.dev/v1alpha1\nkind: KCLRun\nmetadata:\n  name: set-annotation\nspec:\n  # Set dynamic parameters required for the annotation modification model, here we can add the labels we want to modify/add\n  params:\n    annotations:\n      managed-by: kcl-operator\n  # Reference the annotation modification model on OCI\n  source: oci://ghcr.io/kcl-lang/set-annotation\nEOF\n")),(0,o.kt)("h4",{id:"3-deploy-a-pod-to-verify-the-model-result"},"3. Deploy a Pod to Verify the Model Result"),(0,o.kt)("p",null,"Execute the following command to deploy a ",(0,o.kt)("inlineCode",{parentName:"p"},"Pod")," resource:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f- << EOF\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx\n  annotations:\n    app: nginx\nspec:\n  containers:\n  - name: nginx\n    image: nginx:1.14.2\n    ports:\n    - containerPort: 80\nEOF\nkubectl get po nginx -o yaml | grep kcl-operator\n")),(0,o.kt)("p",null,"We can see the following output:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"    managed-by: kcl-operator\n")),(0,o.kt)("p",null,"We can see that the Nginx Pod automatically added the annotation ",(0,o.kt)("inlineCode",{parentName:"p"},"managed-by=kcl-operator"),"."),(0,o.kt)("p",null,"In addition, besides referencing an existing model for the source field of the ",(0,o.kt)("inlineCode",{parentName:"p"},"KCLRun")," resource, we can directly set KCL code for the source field to achieve the same effect. For example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: krm.kcl.dev/v1alpha1\nkind: KCLRun\nmetadata:\n  name: set-annotation\nspec:\n  params:\n    annotations:\n      managed-by: kcl-operator\n  # Resource modification can be achieved with just one line of KCL code\n  source: |\n    items = [item | {metadata.annotations: option("params").annotations} for item in option("items")]\n')),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"registry",src:n(40480).Z,width:"1972",height:"1000"})),(0,o.kt)("p",null,"We have provided more than 30 built-in models, and you can find more code examples in the following link: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang/krm-kcl/tree/main/examples"},"https://github.com/kcl-lang/krm-kcl/tree/main/examples")),(0,o.kt)("p",null,"For example"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Use the ",(0,o.kt)("inlineCode",{parentName:"li"},"web-service")," model to directly instantiate the Kubernetes resources required for a web application"),(0,o.kt)("li",{parentName:"ul"},"Add annotations to existing k8s resources using the ",(0,o.kt)("inlineCode",{parentName:"li"},"set-annotation")," model"),(0,o.kt)("li",{parentName:"ul"},"Use the ",(0,o.kt)("inlineCode",{parentName:"li"},"https-only")," model to verify that your ",(0,o.kt)("inlineCode",{parentName:"li"},"Ingress")," configuration can only be set to https, otherwise an error will be reported.")),(0,o.kt)("h3",{id:"vault-integration"},"Vault Integration"),(0,o.kt)("p",null,"In just three steps, we can use ",(0,o.kt)("inlineCode",{parentName:"p"},"Vault")," to store and manage sensitive information and use it in KCL."),(0,o.kt)("p",null,"Firstly, we install and use Vault to store ",(0,o.kt)("inlineCode",{parentName:"p"},"foo")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"bar")," information."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"vault kv put secret/foo foo=foo\nvault kv put secret/bar bar=bar\n")),(0,o.kt)("p",null,"Then write the following KCL code (main.k)"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'apiVersion = "apps/v1"\nkind = "Deployment"\nmetadata = {\n    name = "nginx"\n    labels.app = "nginx"\n    annotations: {\n        "secret-store": "vault"\n        # Valid format:\n        #  "ref+vault://PATH/TO/KV_BACKEND#/KEY"\n        "foo": "ref+vault://secret/foo#/foo"\n        "bar": "ref+vault://secret/bar#/bar"\n    }\n}\nspec = {\n    replicas = 3\n    selector.matchLabels = metadata.labels\n    template.metadata.labels = metadata.labels\n    template.spec.containers = [\n        {\n            name = metadata.name\n            image = "${metadata.name}:1.14.2"\n            ports = [{ containerPort = 80 }]\n        }\n    ]\n}\n')),(0,o.kt)("p",null,"Finally, the decrypted configuration can be obtained through the ",(0,o.kt)("inlineCode",{parentName:"p"},"vals")," command-line tool"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"kcl main.k | vals eval -f -\n")),(0,o.kt)("p",null,"For more details and use cases, please refer to ",(0,o.kt)("a",{parentName:"p",href:"https://kcl-lang.io/docs/user_docs/guides/secret-management/vault"},"here")),(0,o.kt)("h3",{id:"gitlab-ci-integration"},"GitLab CI Integration"),(0,o.kt)("p",null,"Using KCL, we can not only use Github Action as CI for application publishing through GitOps, but also provide GitLab CI integration in this version. Please refer to: ",(0,o.kt)("em",{parentName:"p"},(0,o.kt)("a",{parentName:"em",href:"https://kcl-lang.io/docs/user_docs/guides/ci-integration/gitlab-ci"},"https://kcl-lang.io/docs/user_docs/guides/ci-integration/gitlab-ci"))),(0,o.kt)("h2",{id:"other-updates-and-bug-fixes"},"Other Updates and Bug Fixes"),(0,o.kt)("p",null,"See ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang/kcl/compare/v0.5.0...v0.6.0"},"here")," for more updates and bug fixes."),(0,o.kt)("h2",{id:"documents"},"Documents"),(0,o.kt)("p",null,"The versioning semantic option is added to the ",(0,o.kt)("a",{parentName:"p",href:"https://kcl-lang.io/"},"KCL website"),". Currently, v0.4.x, v0.5.x and v0.6.0 versions are supported."),(0,o.kt)("h2",{id:"community"},"Community"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Thank @jakezhu9 for his contribution to converting KCL Import tools, including Terraform Provider Schema, JsonSchema, JSON, YAML, and other configuration formats/data to KCL schema/configurations \ud83d\ude4c"),(0,o.kt)("li",{parentName:"ul"},"Thank @xxmao123 for her contribution to connecting KCL LSP language server to the Idea IDE extension \ud83d\ude4c"),(0,o.kt)("li",{parentName:"ul"},"Thank @starkers for his contribution to the KCL NeoVim extension \ud83d\ude4c"),(0,o.kt)("li",{parentName:"ul"},"Thank @starkers for adding KCL installation support to mason.nvim registry \ud83d\ude4c"),(0,o.kt)("li",{parentName:"ul"},"Thank @Ekko for his contribution to the integration of KCL cloud native tools and KCL Operator \ud83d\ude4c"),(0,o.kt)("li",{parentName:"ul"},"Thank @prahalaramji for the upgrade, update, and contribution to the KCL Homebrew installation script \ud83d\ude4c"),(0,o.kt)("li",{parentName:"ul"},"Thank @yyxhero for providing assistance and support in the Helmfile KCL plugin support \ud83d\ude4c"),(0,o.kt)("li",{parentName:"ul"},"Thank @nkabir, @mihaigalos, @prahalaramji, @yamin-oanda, @dhhopen, @magick93, @MirKml, @kolloch, @steeling, and others for their valuable feedback and discussion during the past two months of using KCL. \ud83d\ude4c")),(0,o.kt)("h2",{id:"additional-resources"},"Additional Resources"),(0,o.kt)("p",null,"For more information, see ",(0,o.kt)("a",{parentName:"p",href:"https://kcl-lang.io/docs/user_docs/support/"},"KCL FAQ"),"."),(0,o.kt)("h2",{id:"resources"},"Resources"),(0,o.kt)("p",null,"Thank all KCL users for their valuable feedback and suggestions during this version release. For more resources, please refer to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://kcl-lang.io/"},"KCL Website")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://kusionstack.io/"},"Kusion Website")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/kcl-lang/kcl"},"KCL Repo")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/KusionStack/kusion"},"Kusion Repo"))),(0,o.kt)("p",null,"See the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang/community"},"community")," for ways to join us. \ud83d\udc4f\ud83d\udc4f\ud83d\udc4f"))}d.isMDXComponent=!0},55779:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/docgen-ebe405b469fef789e9bf3df2abb61f74.png"},93713:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ide-format-en-b3de31822a737122bc4107efc408db23.png"},4102:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ide-func-hover-5c7c9276b2b0b52d9275474f8cbbd688.png"},98273:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/ide-quick-fix-en-d12cfabe820bd3932d066a543f288206.png"},40480:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/registry-cd35895be6f805c239d719bce0001163.png"},47669:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/overview-8fba05fd4572ba3eeb1d34267098168c.png"},28522:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/overview-1a92596ca2fc24561c231c91145aef4e.png"}}]);