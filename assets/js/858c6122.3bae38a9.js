"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[54642],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,l=e.originalType,s=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),m=u(n),h=i,g=m["".concat(s,".").concat(h)]||m[h]||p[h]||l;return n?a.createElement(g,o(o({ref:t},c),{},{components:n})):a.createElement(g,o({ref:t},c))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=n.length,o=new Array(l);o[0]=h;var r={};for(var s in t)hasOwnProperty.call(t,s)&&(r[s]=t[s]);r.originalType=e,r[m]="string"==typeof e?e:i,o[1]=r;for(var u=2;u<l;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},773:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>l,metadata:()=>r,toc:()=>u});var a=n(87462),i=(n(67294),n(3905));const l={slug:"2023-08-31-helmfile-kcl-plugin",title:"5-Minute Gameplay with Helmfile KCL Plugin for Easy Management of Kubernetes Helm Charts",authors:{name:"KCL Team",title:"KCL Team"},tags:["KCL","Biweekly-Newsletter"]},o=void 0,r={permalink:"/blog/2023-08-31-helmfile-kcl-plugin",editUrl:"https://github.com/kcl-lang/kcl-lang.io/tree/main/blog/2023-08-31-helmfile-kcl-plugin/index.md",source:"@site/blog/2023-08-31-helmfile-kcl-plugin/index.md",title:"5-Minute Gameplay with Helmfile KCL Plugin for Easy Management of Kubernetes Helm Charts",description:"What is KCL",date:"2023-08-31T00:00:00.000Z",formattedDate:"August 31, 2023",tags:[{label:"KCL",permalink:"/blog/tags/kcl"},{label:"Biweekly-Newsletter",permalink:"/blog/tags/biweekly-newsletter"}],readingTime:3.755,hasTruncateMarker:!1,authors:[{name:"KCL Team",title:"KCL Team"}],frontMatter:{slug:"2023-08-31-helmfile-kcl-plugin",title:"5-Minute Gameplay with Helmfile KCL Plugin for Easy Management of Kubernetes Helm Charts",authors:{name:"KCL Team",title:"KCL Team"},tags:["KCL","Biweekly-Newsletter"]},prevItem:{title:"KCL Introduction Platform Engineering Tech Summit 2023 Meeting",permalink:"/blog/2023-platform-engineering-tech-summit"},nextItem:{title:"KCL Biweekly Newsletter (2023 08.10 - 08.23) | KCL v0.5.3, v0.5.4 and v0.5.5 are out!",permalink:"/blog/2023-08-23-biweekly-newsletter"}},s={authorsImageUrls:[void 0]},u=[{value:"What is KCL",id:"what-is-kcl",level:2},{value:"What is Helmfile",id:"what-is-helmfile",level:2},{value:"Using the Helmfile KCL Plugin",id:"using-the-helmfile-kcl-plugin",level:2},{value:"1. Tool Installation",id:"1-tool-installation",level:3},{value:"2. Create the Helmfile Configuration File",id:"2-create-the-helmfile-configuration-file",level:3},{value:"3. Run the Helmfile Tool",id:"3-run-the-helmfile-tool",level:3},{value:"Want More?",id:"want-more",level:2},{value:"Conclusion",id:"conclusion",level:2},{value:"Resources",id:"resources",level:2}],c={toc:u},m="wrapper";function p(e){let{components:t,...l}=e;return(0,i.kt)(m,(0,a.Z)({},c,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"what-is-kcl"},"What is KCL"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang"},"KCL")," is an open-source, constraint-based record and functional language that enhances the writing of complex configurations, including those for cloud-native scenarios. With its advanced programming language technology and practices, KCL is dedicated to promoting better modularity, scalability, and stability for configurations. It enables simpler logic writing and offers ease of automation APIs and integration with homegrown systems."),(0,i.kt)("h2",{id:"what-is-helmfile"},"What is Helmfile"),(0,i.kt)("p",null,"Helmfile is a declarative specification and tool for simplifying and managing Helm Charts. The Helmfile KCL Plugin provides additional functionality to the Helmfile tool, making it more convenient and efficient to use. With the Helmfile KCL Plugin, you can:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Edit or validate Helm Chart configurations directly on the client-side using non-intrusive hooks. This allows you to separate the data and logic parts of Kubernetes configuration management without needing to fork the upstream Chart to modify internal logic include modifying resource labels/annotations and injecting Sidecar container configurations."),(0,i.kt)("li",{parentName:"ul"},"Validate Kubernetes resources using KCL Schema, define your own abstract models, and share them for reusability.")),(0,i.kt)("p",null,"In this blog, we will quickly guide you through getting started with the Helmfile KCL Plugin, enabling you to easily manage your Kubernetes Helm Charts."),(0,i.kt)("p",null,"We will explain in detail using a simple example. With the Helmfile KCL Plugin, you do not need to install any components related to KCL. You only need the latest version of the Helmfile tool (v0.156.0+) on your local machine."),(0,i.kt)("h2",{id:"using-the-helmfile-kcl-plugin"},"Using the Helmfile KCL Plugin"),(0,i.kt)("h3",{id:"1-tool-installation"},"1. Tool Installation"),(0,i.kt)("p",null,"First, make sure you have installed the Helmfile client tool. You can follow the instructions in the documentation link below."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/helmfile/helmfile"},"https://github.com/helmfile/helmfile")),(0,i.kt)("h3",{id:"2-create-the-helmfile-configuration-file"},"2. Create the Helmfile Configuration File"),(0,i.kt)("p",null,"Create a file named helmfile.yaml in the root directory of your project and write the configuration using Helmfile syntax. In this file, you can specify the Helm Charts to use, configuration values, and any other functionality supported by Helmfile. Additionally, you can use the features of the KCL Plugin in helmfile.yaml to load configurations and make in-place modifications and validations to the Helm Chart."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'repositories:\n- name: prometheus-community\n  url: https://prometheus-community.github.io/helm-charts\nreleases:\n- name: prom-norbac-ubuntu\n  namespace: prometheus\n  chart: prometheus-community/prometheus\n  set:\n  - name: rbac.create\n    value: false\n  transformers:\n  # Use KCL Plugin to mutate or validate Kubernetes manifests.\n  - apiVersion: krm.kcl.dev/v1alpha1\n    kind: KCLRun\n    metadata:\n      name: "set-annotation"\n      annotations:\n        config.kubernetes.io/function: |\n          container:\n            image: docker.io/kcllang/kustomize-kcl:v0.2.0\n    spec:\n      source: |\n        # A single line of KCL code can be used to modify workload configurations in-place.\n        items = [resource | {if resource.kind == "Deployment": metadata.annotations: {"managed-by" = "helmfile-kcl"}} for resource in option("resource_list").items]\n')),(0,i.kt)("p",null,"In the above configuration, we reference the Prometheus Helm Chart and use a single line of KCL code to inject the label ",(0,i.kt)("inlineCode",{parentName:"p"},'managed-by="helmfile-kcl"')," to all the Deployment resources of Prometheus."),(0,i.kt)("h3",{id:"3-run-the-helmfile-tool"},"3. Run the Helmfile Tool"),(0,i.kt)("p",null,"Once everything is set up, you can run the Helmfile command to deploy, manage, and maintain your Helm Charts. Use the following command to apply the configuration mentioned above to the cluster."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"helmfile apply\n")),(0,i.kt)("p",null,"You should see the following output if everything goes well:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'Adding repo prometheus-community https://prometheus-community.github.io/helm-charts\n"prometheus-community" has been added to your repositories...\n\n...\n')),(0,i.kt)("h2",{id:"want-more"},"Want More?"),(0,i.kt)("p",null,"For the above helmfile configuration, you can encapsulate it as a reusable logic for configuration modification without constantly writing and copying/pasting KCL code. Additionally, many commonly used Kubernetes configuration editing and validation code snippets are already packaged in the KCL official Registry: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/orgs/kcl-lang/packages"},"https://github.com/orgs/kcl-lang/packages")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"registry",src:n(77078).Z,width:"1080",height:"1064"})),(0,i.kt)("p",null,"In addition to supporting writing KCL code in configuration files, we also support directly referencing code snippets in Registry, as shown below"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: krm.kcl.dev/v1alpha1\nkind: KCLRun\nmetadata:\n  name: https-only\n  annotations: \n    krm.kcl.dev/version: 0.0.1\n    krm.kcl.dev/type: validation\n    documentation: >-\n      Requires Ingress resources to be HTTPS only.  Ingress resources must\n      include the `kubernetes.io/ingress.allow-http` annotation, set to `false`.\n      By default a valid TLS {} configuration is required, this can be made\n      optional by setting the `tlsOptional` parameter to `true`.\n      More info: https://kubernetes.io/docs/concepts/services-networking/ingress/#tls\nspec:\n  # Use the OCI source\n  source: oci://ghcr.io/kcl-lang/https-only\n")),(0,i.kt)("p",null,"Specific example codes can be found ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang/krm-kcl/tree/main/examples"},"here")),(0,i.kt)("p",null,"If you want to contribute more KCL code repositories, feel free to contact us and refer to the documentation for contribution: ",(0,i.kt)("a",{parentName:"p",href:"https://kcl-lang.io/zh-CN/docs/user_docs/guides/package-management/share_your_pkg/"},"https://kcl-lang.io/zh-CN/docs/user_docs/guides/package-management/share_your_pkg/")),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"This blog provided a quick getting started guide to help you master the basics of the Helmfile KCL Plugin in just 5 minutes. Now, you can start using this powerful tool to simplify and optimize your Kubernetes application deployment process!"),(0,i.kt)("h2",{id:"resources"},"Resources"),(0,i.kt)("p",null,"For more resources, please refer to"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"https://kcl-lang.io/"},"KCL Website"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"https://kusionstack.io/"},"KusionStack Website"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"https://kcl-lang.io/docs/community/release-policy/roadmap"},"KCL 2023 Roadmap"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang/kcl/milestone/6"},"KCL v0.6.0 Milestone"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang/kcl/issues"},"KCL Github Issues"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"https://github.com/orgs/kcl-lang/discussions"},"KCL Github Discussion"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("a",{parentName:"p",href:"https://github.com/kcl-lang/community"},"KCL Community")))))}p.isMDXComponent=!0},77078:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/registry-cb3a2191e72696315540cae3fee50290.png"}}]);